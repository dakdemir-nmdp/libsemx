% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/crossed.R
\name{semx_crossed}
\alias{semx_crossed}
\title{Fit Crossed Random Effects Model using Method of Moments}
\usage{
semx_crossed(
  formula,
  data,
  u,
  v,
  use_gls = FALSE,
  second_step = FALSE,
  verbose = FALSE,
  min_variance = 1e-10
)
}
\arguments{
\item{formula}{Model formula for fixed effects (e.g., y ~ x1 + x2).}

\item{data}{Data frame containing the variables.}

\item{u}{Name of the column for the first random effect grouping factor.}

\item{v}{Name of the column for the second random effect grouping factor.}

\item{use_gls}{Logical; if TRUE, refine fixed effects using GLS after initial OLS estimation (default: FALSE).}

\item{second_step}{Logical; if TRUE, perform a second MoM step using GLS residuals (default: FALSE).}

\item{verbose}{Logical; if TRUE, print convergence details (default: FALSE).}

\item{min_variance}{Numeric; minimum variance floor for variance components (default: 1e-10).}
}
\value{
An object of class \code{semx_crossed_fit} with the following components:
\describe{
  \item{beta}{Fixed effects estimates.}
  \item{variance_components}{Variance component estimates c(σ²_u, σ²_v, σ²_e).}
  \item{n_groups_u}{Number of unique levels for first random effect.}
  \item{n_groups_v}{Number of unique levels for second random effect.}
  \item{converged}{Logical indicating convergence.}
  \item{message}{Convergence message.}
  \item{fixed_names}{Names of fixed effects.}
  \item{u_name}{Name of first random grouping factor.}
  \item{v_name}{Name of second random grouping factor.}
}
}
\description{
Fits a linear mixed model with two crossed random effects using the Method of Moments (MoM).
This provides fast O(N) estimation for models of the form:
}
\details{
\deqn{y = X\beta + Z_u u + Z_v v + e}

where u ~ N(0, σ²_u I), v ~ N(0, σ²_v I), and e ~ N(0, σ²_e I).

The MoM approach uses U-statistics (Gao & Owen 2017, 2018) to estimate variance components
without iterative optimization, making it ideal for large-scale datasets.
}
\examples{
\dontrun{
# Simulate data with crossed random effects
set.seed(42)
n_students <- 30
n_schools <- 15
n_reps <- 4

data <- expand.grid(
  student = 1:n_students,
  school = 1:n_schools,
  rep = 1:n_reps
)
data$x <- rnorm(nrow(data))
data$y <- 5.0 + 1.5 * data$x +
  rnorm(n_students)[data$student] * sqrt(0.6) +  # student effects
  rnorm(n_schools)[data$school] * sqrt(0.4) +    # school effects
  rnorm(nrow(data)) * sqrt(0.3)                  # residual

# Fit model
fit <- semx_crossed(y ~ 1 + x, data, u = "student", v = "school")
print(fit)
summary(fit)
}

}
\references{
Gao, K., & Owen, A. B. (2017). Efficient moment calculations for variance components
in large unbalanced crossed random effects models. Electronic Journal of Statistics,
11(1), 1235-1296.

Gao, K., & Owen, A. B. (2018). Estimation and inference for very large linear mixed
effects models. Statistica Sinica, 30(3), 1741-1771.
}
